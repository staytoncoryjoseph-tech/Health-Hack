<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#070d1b" />
  <title>Meal Log | AI Nutritionist (Lupus-aware)</title>
  <link rel="stylesheet" href="meal.css" />
</head>

<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo">ðŸ¥—</div>
        <div>
          <div class="title">Meal Log</div>
          <div class="subtitle">AI Nutritionist (Local Brain â€¢ Lupus-aware)</div>

          <!-- LIVE DAY/TIME + LAST SAVED (wired by meal.js) -->
          <div class="subtitle" style="margin-top:6px; display:flex; gap:10px; flex-wrap:wrap">
            <span id="mealNow">ðŸ•’ â€”</span>
            <span id="mealLastSaved">Last saved: â€”</span>
          </div>
        </div>
      </div>

      <div class="topbar-actions">
        <button class="btn btn-ghost" id="btnExport" type="button">Export</button>
        <button class="btn btn-ghost" id="btnImport" type="button">Import</button>
        <input id="importFile" type="file" accept="application/json" hidden />
        <button class="btn btn-danger" id="btnReset" type="button">Reset</button>
      </div>
    </header>

    <main class="grid">
      <!-- LEFT: Log + List -->
      <section class="card">
        <div class="card-head">
          <h2>Log a meal</h2>
          <div class="muted">
            Photo + macros + tags. Saved locally (no Firebase).
            Lupus-aware coaching is education only â€” not medical advice.
          </div>
        </div>

        <form id="mealForm" class="form">
          <div class="row">
            <div class="field">
              <label for="mealName">Meal name</label>
              <input id="mealName" name="mealName" placeholder="e.g., Salmon + rice bowl" required />
            </div>

            <div class="field">
              <label for="mealTime">Time</label>
              <input id="mealTime" name="mealTime" type="time" />
              <div class="hint">Optional â€” we also save a full timestamp automatically.</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="servings">Servings</label>
              <input id="servings" name="servings" type="number" min="0.25" step="0.25" value="1" />
            </div>

            <div class="field">
              <label for="calories">Calories</label>
              <input id="calories" name="calories" type="number" min="0" step="1" placeholder="Optional" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="protein">Protein (g)</label>
              <input id="protein" name="protein" type="number" min="0" step="1" placeholder="Optional" />
            </div>

            <div class="field">
              <label for="carbs">Carbs (g)</label>
              <input id="carbs" name="carbs" type="number" min="0" step="1" placeholder="Optional" />
            </div>

            <div class="field">
              <label for="fat">Fat (g)</label>
              <input id="fat" name="fat" type="number" min="0" step="1" placeholder="Optional" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="fiber">Fiber (g)</label>
              <input id="fiber" name="fiber" type="number" min="0" step="1" placeholder="Optional" />
            </div>

            <div class="field">
              <label for="sodium">Sodium (mg)</label>
              <input id="sodium" name="sodium" type="number" min="0" step="10" placeholder="Optional" />
              <div class="hint">Helpful to notice patterns (swelling/BP awareness) â€” education only.</div>
            </div>

            <div class="field">
              <label for="sugar">Added sugar (g)</label>
              <input id="sugar" name="sugar" type="number" min="0" step="1" placeholder="Optional" />
            </div>
          </div>

          <!-- PHOTO MEAL LOGGING -->
          <div class="row">
            <div class="field">
              <label for="mealPhoto">Meal photo</label>
              <input id="mealPhoto" type="file" accept="image/*" capture="environment" />
              <div class="hint">Take a photo or upload one. We compress it so it saves fast.</div>

              <div class="photo-preview" id="photoPreview" hidden>
                <img id="photoImg" alt="Meal photo preview" />
                <div class="photo-actions">
                  <button class="btn btn-ghost" type="button" id="btnRemovePhoto">Remove photo</button>
                </div>
              </div>

              <input id="photoData" type="hidden" value="" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="tags">Tags</label>
              <input id="tags" name="tags" placeholder="e.g., breakfast, anti-inflammatory, low-sodium, homemade" />
              <div class="hint">Comma-separated. Used by the AI coach.</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="notes">Notes</label>
              <textarea
                id="notes"
                name="notes"
                rows="3"
                placeholder="How you felt (fatigue, joint pain), cravings, stress, flare feelings, salt meal, etc."
              ></textarea>
              <div class="hint">Optional. Notes help spot patterns (food â†” energy/symptoms). Education only.</div>
            </div>
          </div>

          <div class="row actions">
            <button class="btn btn-primary" type="submit" id="btnSave">Add meal</button>
            <button class="btn btn-ghost" type="button" id="btnClearForm">Clear</button>
          </div>

          <input id="editId" type="hidden" value="" />
        </form>

        <hr class="sep" />

        <div class="list-tools">
          <div class="field">
            <label for="search">Search meals</label>
            <input id="search" placeholder="Search by name, tag, note..." />
          </div>

          <div class="field">
            <label for="daySelect">Day</label>
            <input id="daySelect" type="date" />
          </div>
        </div>

        <div id="mealList" class="meal-list"></div>
      </section>

      <!-- RIGHT: Dashboard + AI Coach -->
      <aside class="stack">
        <section class="card">
          <div class="card-head">
            <h2>Todayâ€™s dashboard</h2>
            <div class="muted" id="dayLabel">â€”</div>
          </div>

          <div class="pill-grid">
            <div class="pill-card">
              <div class="pill-title">Calories</div>
              <div class="pill-value" id="sumCalories">0</div>
              <div class="pill-sub" id="targetCalories">Target: â€”</div>
            </div>
            <div class="pill-card">
              <div class="pill-title">Protein</div>
              <div class="pill-value" id="sumProtein">0g</div>
              <div class="pill-sub" id="targetProtein">Target: â€”</div>
            </div>
            <div class="pill-card">
              <div class="pill-title">Carbs</div>
              <div class="pill-value" id="sumCarbs">0g</div>
              <div class="pill-sub" id="targetCarbs">Target: â€”</div>
            </div>
            <div class="pill-card">
              <div class="pill-title">Fat</div>
              <div class="pill-value" id="sumFat">0g</div>
              <div class="pill-sub" id="targetFat">Target: â€”</div>
            </div>
          </div>

          <div class="mini">
            <div class="mini-row">
              <span>Fiber</span><strong id="sumFiber">0g</strong>
            </div>
            <div class="mini-row">
              <span>Sodium</span><strong id="sumSodium">0mg</strong>
            </div>
            <div class="mini-row">
              <span>Added sugar</span><strong id="sumSugar">0g</strong>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-head">
            <h2>Goals & modes</h2>
            <div class="muted">Set targets so coaching becomes precise.</div>
          </div>

          <div class="form compact">
            <div class="row">
              <div class="field">
                <label for="mode">Coaching mode</label>
                <select id="mode">
                  <option value="general">General</option>
                  <option value="fatloss">Fat loss</option>
                  <option value="muscle">Muscle gain</option>
                  <option value="lupus_support">Lupus-support (education)</option>
                </select>
                <div class="hint">Education-only: balanced meals, sodium awareness, steady energy support.</div>
              </div>

              <div class="field">
                <label for="risk">Preference</label>
                <select id="risk">
                  <option value="balanced">Balanced</option>
                  <option value="strict">Strict</option>
                  <option value="gentle">Gentle</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="goalCalories">Calories target</label>
                <input id="goalCalories" type="number" min="0" step="50" placeholder="e.g., 2000" />
              </div>

              <div class="field">
                <label for="goalProtein">Protein (g)</label>
                <input id="goalProtein" type="number" min="0" step="5" placeholder="e.g., 140" />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="goalCarbs">Carbs (g)</label>
                <input id="goalCarbs" type="number" min="0" step="5" placeholder="e.g., 200" />
              </div>

              <div class="field">
                <label for="goalFat">Fat (g)</label>
                <input id="goalFat" type="number" min="0" step="5" placeholder="e.g., 70" />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="goalSodium">Sodium cap (mg)</label>
                <input id="goalSodium" type="number" min="0" step="50" placeholder="e.g., 2000" />
              </div>

              <div class="field">
                <label for="goalSugar">Added sugar cap (g)</label>
                <input id="goalSugar" type="number" min="0" step="5" placeholder="e.g., 36" />
              </div>
            </div>

            <div class="row actions">
              <button class="btn btn-primary" id="btnSaveGoals" type="button">Save goals</button>
              <button class="btn btn-ghost" id="btnAutoGoals" type="button">Auto-set</button>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-head">
            <h2>AI Nutritionist</h2>
            <div class="muted">Rule-based coaching + Q&A (no API).</div>
          </div>

          <div class="coach">
            <div class="coach-row">
              <button class="btn btn-primary" id="btnCoach" type="button">Run coaching</button>
              <button class="btn btn-ghost" id="btnCoachDeep" type="button">Deep audit</button>
            </div>

            <div class="coach-out" id="coachOut">
              <div class="empty">Log meals, set goals, then run coaching.</div>
            </div>

            <div class="disclaimer">
              Education only â€” not medical advice. Lupus varies person-to-person; confirm targets and restrictions with your clinician/dietitian.
            </div>

            <hr class="sep" />

            <!-- ASK NUTRITIONIST CHAT -->
            <div class="card-head" style="margin-top:10px">
              <h3 style="margin:0">Ask the Nutritionist</h3>
              <div class="muted">Ask a question â€” it replies instantly (local rules).</div>
            </div>

            <div class="coach-out" id="nutriChat" style="margin-top:10px">
              <div class="empty">Type a question below (protein, cravings, calories, meal timingâ€¦).</div>
            </div>

            <div class="coach-row" style="margin-top:10px">
              <input id="nutriInput" placeholder="Ask about protein, cravings, calories, meal timingâ€¦" />
              <button class="btn btn-primary" id="nutriSend" type="button">Send</button>
            </div>
          </div>
        </section>
      </aside>
    </main>
  </div>

  <script src="meal.js" defer></script>
</body>
</html>
